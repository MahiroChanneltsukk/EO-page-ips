name: IPæ®µæ‰«æ

on:
  workflow_dispatch:
  push:
    branches: [ main ]
    paths: [ 'scan_ips.py' ]

jobs:
  scan-ips:
    runs-on: ubuntu-latest
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      
    - name: è®¾ç½®Pythonç¯å¢ƒ
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'

        
    - name: å®‰è£…ä¾èµ–
      run: |
        python -m pip install --upgrade pip
        pip install httpx tqdm
        
    - name: è¿è¡ŒIPæ‰«æ
      run: |
        python scan_ips.py
      env:
        CONCURRENCY: 100  # GitHub Actionsç¯å¢ƒå»ºè®®300-500å¹¶å‘
        TIMEOUT: 8.0
        
    - name: ä¸Šä¼ æ‰«æç»“æœ
      uses: actions/upload-artifact@v4
      with:
        name: available-ips
        path: available_ips.txt
        retention-days: 30
        
    - name: æäº¤ç»“æœåˆ°ä»“åº“
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add available_ips.txt
        git commit -m "ğŸ“ˆ æ›´æ–°IPæ‰«æç»“æœ $(date +'%Y-%m-%d %H:%M:%S')" || exit 0
        git push

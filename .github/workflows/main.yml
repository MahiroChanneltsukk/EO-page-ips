name: IPæ®µæ‰«æ

on:
  workflow_dispatch:  # æ‰‹åŠ¨è§¦å‘
  schedule:
    # æ¯å¤©UTCæ—¶é—´2ç‚¹è¿è¡Œï¼ˆåŒ—äº¬æ—¶é—´10ç‚¹ï¼‰
    - cron: '0 2 * * *'
  push:
    branches: [ main ]
    paths: [ 'scan_ips.py' ]

jobs:
  scan-ips:
    runs-on: ubuntu-latest
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      
    - name: è®¾ç½®Pythonç¯å¢ƒ
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        cache: 'pip'
        
    - name: å®‰è£…ä¾èµ–
      run: |
        python -m pip install --upgrade pip
        pip install httpx tqdm
        
    - name: è¿è¡ŒIPæ‰«æ
      run: |
        python scan_ips.py
      env:
        CONCURRENCY: 400  # GitHub Actionsç¯å¢ƒå»ºè®®300-500å¹¶å‘
        
    - name: ä¸Šä¼ æ‰«æç»“æœ
      uses: actions/upload-artifact@v4
      with:
        name: available-ips
        path: available_ips.txt
        retention-days: 30
        
    - name: æäº¤ç»“æœåˆ°ä»“åº“
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add available_ips.txt
        git commit -m "ğŸ“ˆ æ›´æ–°IPæ‰«æç»“æœ $(date +'%Y-%m-%d %H:%M:%S')" || exit 0
        git push
